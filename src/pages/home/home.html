<!-- IS USER AUTHENTICATED -->
<div *ngIf="isUserAuthenticated(); then authenticatedBlock else unknownUserBlock"></div>


<!--The login block for unauthenticated users-->
<ng-template #unknownUserBlock>
  <ion-header>
    <ion-navbar>
      <button ion-button menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
      <ion-title float-left>Home</ion-title>
      <ion-label float-right>{{userService.getUserData("full_name")}}</ion-label>
      <ion-icon float-right name="{{is_network_connected ? 'cloud' : 'thunderstorm'}}"></ion-icon>
    </ion-navbar>
  </ion-header>

  <ion-content class="logged-out">
    <div *ngIf="presentLogoutScreen; then logoutBlock else loginBlock"></div>
  </ion-content>

  <ion-footer>

    <div text-left float-left *ngIf="!isMobileDevice()">
      <ion-label>
        <ion-checkbox color="dark" [(ngModel)]="is_network_connected" (ionChange)="fakeNetworkStateChange()"></ion-checkbox>
        NETWORK
      </ion-label>
    </div>

    <div text-right float-right>
      <img class="footer-logo" src="assets/image/logo-gsi.png" class="logo-trace" width="165" height="50" />
    </div>
  </ion-footer>
</ng-template>




<ng-template #loginBlock>
    <div class="header loginBlock" margin-top text-center>
      <img src="assets/image/logo-traccia.png" class="logo-trace" width="228" height="128" />
      <page-login></page-login>
    </div>
</ng-template>

<ng-template #logoutBlock>
    <div class="header logoutBlock">
      <ion-grid text-center>
        <ion-row>
          <ion-col>
            <div class="user-avatar-wrapper">
              <img [src]="logoutScreenData.img_url">
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <h1>Arrivederci {{logoutScreenData.name}}</h1>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col>
            <ion-label color="darkest">Hai segnalato la tua uscita.</ion-label>
            <ion-label>Oggi {{logoutScreenData.date}} hai lavorato<br/>{{logoutScreenData.duration}}</ion-label>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>
</ng-template>





<!--The block to use to show current status-->
<ng-template #authenticatedBlock>
  <ion-header>
    <ion-navbar>
      <button ion-button menuToggle>
        <ion-icon name="menu"></ion-icon>
      </button>
      <ion-title float-left>Home</ion-title>
      <ion-label float-right>{{userService.getUserData("full_name")}}</ion-label>
      <!--<ion-icon float-right name="{{isConnected() ? 'cloud' : 'thunderstorm'}}"></ion-icon>-->
    </ion-navbar>
  </ion-header>

  <ion-content class="logged-in checked--in--out">
    <div *ngIf="isUserCheckedIn(); then checkedIn else checkedOut"></div>
  </ion-content>

  <ion-footer>
    <div></div>
  </ion-footer>
</ng-template>

<!-- The block for checked OUT user -->
<ng-template #checkedOut>

    <div class="header">
      <ion-fab top right class="qr-scan-fab">
        <button ion-fab color="yellow-light" (tap)="scanQRCode(['IN'])">
          <ion-icon ios="md-qr-scanner" md="md-qr-scanner"></ion-icon>
        </button>
      </ion-fab>

      <ion-grid>
        <ion-row>
          <ion-col>
            <h3>
              <ion-label color="lightest">Ciao {{userService.getUserData("first_name") ||
                userService.getUserData("name")}}!
              </ion-label>
            </h3>
            <p>Bentornato!</p>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <div class="main">
      <ion-grid>
        <ion-row>
          <ion-col>
            <p>Scansiona il <strong>QRcode d'ingresso</strong> per iniziare la tua giornata lavorativa.</p>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

</ng-template>


<!-- The block for checked IN user -->
<ng-template #checkedIn>

    <div class="header">
      <ion-fab top right class="qr-scan-fab">
        <button ion-fab color="yellow-light" (tap)="scanQRCode(['CHK', 'OUT'])">
          <ion-icon ios="md-qr-scanner" md="md-qr-scanner"></ion-icon>
        </button>
      </ion-fab>

      <ion-fab top right class="qr-scan-fab exit" *ngIf="!isMobileDevice()">
        <button ion-fab mini color="danger" (tap)="scanQRCode(['OUT'])">
          <ion-icon ios="md-qr-scanner" md="md-qr-scanner"></ion-icon>
        </button>
      </ion-fab>

      <ion-grid>
        <ion-row>
          <ion-col>
            <p>Stai lavorando da</p>
            <h3>
              <ion-label color="lightest">
                {{shiftTotalDuration}}
              </ion-label>
            </h3>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

    <div class="main">
      <ion-grid>
        <ion-row>
          <ion-col>
            <h5>Scansiona il <strong>QRcode dell'ambiente</strong> da pulire</h5>
          </ion-col>
        </ion-row>
      </ion-grid>


      <ion-grid class="checkin_list">
        <ion-row *ngFor="let checkin of remoteDataService.getAllCheckinsReversed()" ngClass="{{checkin.css_class}}">
          <ion-col col-10>
            <div>
              <ion-icon [name]="checkin.icon" item-left></ion-icon>
              {{checkin.name}} ({{checkin.duration}})
            </div>
          </ion-col>
          <ion-col col-2 text-right="">
            <div>
              {{checkin.getFormattedTime()}}
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </div>

</ng-template>







